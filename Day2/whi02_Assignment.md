## VPC

**Virtual Private Cloud로**

 퍼블릭 클라우드 내에서 호스팅되는 안전하고 격리된 프라이빗 클라우드이다.

쉽게 말하면 클라우드 내 가상 네트워크 공간을 의미한다.

예를 들어 클라우드는  붐비는 식당이라고 생각하고, 그 중 예약된 테이블이 VPC 라고 생각하면 쉽다.

장점

논리적으로 격리된 네트워크를 리전 전체에 걸쳐 제공해 다른 사용자의 네트워크와 상호 간섭 되는 일 없이 클라우드 상에 안전한 인프라를 구축할 수 있다.

VPC는 어떻게 퍼블릭 클라우드에서 격리될 수 있을까?

1. Subnet : 네트워크 내 모든 사람이 사용할 수 없도록 한다.
2. VLAN : LAN을 분할하여 격리한다.
3. VPN  : 암호화를 사용하여 공용 네트워크에 사설 네트워크를 만든다.

프라이빗 클라우드를 사용하지 않고, VPC를 사용하면 어떤 점이 좋을까?

1. 확장성 : VPC는 퍼블릭 클라우드 공급자가 호스팅하기 때문에, 고객이 필요에 따라 컴퓨팅 리소스를 추가할 수 있다.
2. 성능 향상 : 클라우드 호스팅 웹 사이트와 애플리케이션은 일반적으로 로컬 On-premise 서버에서 호스팅되는 것 보다 더 좋은 성능을 보인다.

<img width="544" height="334" alt="image" src="https://github.com/user-attachments/assets/ed7653d9-3a27-4d27-8cd8-ea008e9b08a6" />

<br />

## IGW

AWS에서 사용하는 Internet GateWay이다.

그러면 Internet Gateway는 무엇일까?

1. 인터넷 연결 (액세스) 제공
    - VPC 리소스가 외부로 통신할 수 있게 하고, 또한 외부에서 VPC를 통한 통신도 지원한다.
2. VPC와 연동
    - VPC 내 서브넷들은 하나의 IGW를 통해 통신할 수 있게 한다.

<img width="1302" height="790" alt="image" src="https://github.com/user-attachments/assets/798af605-91d4-4ec0-be1f-9818337b23fe" />


장점

여러 가용 영역에 걸쳐 배포 되어 있고, 필요에 따라 IGW를 쉽게 확장할 수 있다.

NAT Gateway와 차이점

IGW는 양방향 통신을 지원하지만, NAT Gateay는 외부에서 VPC 내부로 직접 트래픽을 초기화할 수 없다.

사례 : 여러 리소스가 외부와 통신해야 하는 상황에서는 IGW를 사용하고, 보안을 강화해야 하는 경ㅇ NAT Gateway를 사용한다.

## NAT

Network Address Translation로

NAT는 IP 주소 변환 기술이다.

네트워크 상에서 사설 IP 주소를 공인 IP 주소로 변환 하거나 반대로 변환할 때 사용 된다.

주로 사설 네트워크, 공인 네트워크 간의 통신을 가능 하게 하는 역할을 한다.

### NAT를 사용하는 이유

- 사설 네트워크에 속한 많은 호스트가 하나의 공인 IP 주소를 사용 하여 인터넷에 접속 하기 위해 사용한다.

    —> IP 주소 절약

- 라우터 외부로 트래픽이 나갈 때 호스트의 사설 IP가 공인 IP로 변환 되므로 호스트 IP를 숨긴다.

    —> 보안

<img width="1302" height="790" alt="image" src="https://github.com/user-attachments/assets/52829e6f-d917-43d8-a002-c6a13a9447ef" />

### Static NAT (정적 NAT)

- 정적 IP 매핑 : 사설 IP 주소를 하나의 공인 IP 주소에 매핑한다.
- 용도 : 특정 내부 서버에 대해 일관된 공인 IP 주소를 사용 해야 할 때 사용한다.

### Dynamic NAT (동적 NAT)

- 동적 IP 매핑 : 사설 IP 주소를 공인 IP 주소 풀에서 사용 가능한 IP로 변환 한다.
- 용도 : 사설 네트워크에서 여러 장치가 외부 네트워크에 접근할 때, 공인 IP 주소를 동적으로 할당하여 사용한다.

### PAT (Port Address Translation, 포트 주소 변환)

- 여러 장치가 하나의 공인 IP 주소를 공유 하면서 포트 번호를 이용해 구별한다.
- 용도 : 많은 장치가 하나의 공인 IP 주소를 공유하면서 인터넷에 접근할 수 있도록 한다.

### NAT의 동작 방식

1. 내부 장치에서 외부로 요청
    - 내부 네트워크의 장치가 인터넷에 접속하려 할 때, 사설 IP 주소와 포트 번호를 포함한 패킷이 NAT로 전송한다.
2. NAT 장치에서 IP 주소 변환
    - NAT 장치는 사설 IP 주소를 공인 IP 주소로, 포트 번호를 새로 지정하여 외부 네트워크로 전송한다.
3. 외부 응답 수신
    - 외부 네트워크에서 응답 패킷이 공인 IP 주소와 포트 번호로 돌아온다.
4. NAT 장치에서 응답 변환
    - NAT 장치는 응답 패킷을 내부 장치의 사설 IP 주소로 변환하여 해당 장치에 전달한다.

<img width="1302" height="790" alt="image" src="https://github.com/user-attachments/assets/59843dc7-b1f7-4ef4-ab70-56e7a1ea1848" />


## AWS에서의 NAT

NAT 게이트웨이는 NAT(네트워크 주소 변환) 서비스이다. NAT 게이트웨이를 사용하면 **프라이빗 서브넷**의 인스턴스가 VPC 외부의 서비스에 연결할 수 있다.

외부 서비스에서 이러한 **인스턴스와의 연결을 시작할 수는 없도록 할 수 있다**.

AWS에서 NAT 게이트웨이를 만들 때 2가지 중 하나를 지정한다.

- 퍼블릭 NAT 게이트웨이 (디폴트 값) : 사설 ip 주소를 연결하여 **사설 서브넷 인스턴스가 인터넷에 접근**하도록 한다.
트래픽은 인터넷 게이트웨이를 통해 라우팅된다.
- 프라이빗 NAT 게이트웨이 : 사설 서브넷에 배치되어 인터넷과 연결되지 않는다.
트래픽은 전송 게이트웨이, 가상 프라이빗 게이트웨이를 통해 다른 VPC로 라우팅된다.

<img width="1302" height="790" alt="image" src="https://github.com/user-attachments/assets/c9fde7b6-f5ab-49e3-b665-cdea341a0015" />


## Routing Table

목적지 주소를 목적지 까지 이동할 수 있도록 하는 네트워크 경로로 변환하는 목적으로 사용된다.

모든 목적지 정보에 대해 그 목적지에 도달하기 위해서 거쳐야 할 다음 라우터의 정보를 가지고 있다.

정리하면, 

네트워크상의 특정 목적지까지의 거리와 가는 방법 등을 명시 하고 있는 테이블이라고 할 수 있다.

Routing Table의 구성 요소

1. 네트워크 대상 : 목적지 네트워크의 IP 주소
2. SubnetMask
3. GateWay
4. 인터페이스 : 게이트웨이로 가기 위한 장치
5. 우선 순위 (Metric) : 패킷 전송을 위해 최적의 경로를 설정하기 위한 것.

<img width="569" height="235" alt="image" src="https://github.com/user-attachments/assets/0eb92b25-5b9f-4438-aac2-d3b4a27dc89b" />


## SSH

Secure Shell Protocol로 컴퓨터와 컴퓨터가 Internet 같은 Public 네트워크를 통해 통신할 때 보안적을 안전하게 하는 프로토콜이다.

SSH를 사용하는 이유는 다른 프로토콜을 사용할 시 민감한 정보를 주고받는 다면, 정보를 직접 네트워크에 넘기기 때문에 보안에서 굉장히 취약하다.

SSH의 동작 과정

1. SSH 클라이언드가 SSH 접속을 시도하면 SSH Server는 서로의 키가 일치하는지 확인하기 위해 서버의 공개키로 암호화된 메시지를 보낸다.
2. 클라이언트는 비밀 키를 이용해 복호화 하여 서버에 보낸다.
3. 서버는 비밀키가 자신의 공개키 와 한쌍인 것을 확인한다.
4. 인증되면 서버는 통신을 위한 대칭키를 생성한다.

    모든 통신 간 암호화 하는데 사용된다.


<img width="825" height="458" alt="image" src="https://github.com/user-attachments/assets/2a8ad957-3bd9-4128-a22a-1092187f75d7" />
